extends ./layout/layout_main.pug

block css
  style.
    .logged-in {
      display: block !important;
    }
    .logged-out {
      display: none;
    }
  //- style


block content

  div(Zng-app="myApp" Zng-controller="myCtrl" ng-cloak)

    .banner.userprofile
      .gradient
      .info
        .container
          .row
            .col-sm-3.col-md-3
              .photo
                .img
                  a(href='#modal_coming_soon', data-toggle='modal')
                    i.fa.fa-camera
                  //- a
                  img(ng-src="{{user.avatar}}", alt="")
                //- img
                .name
                  span {{user.full_name}}&nbsp;
                  sup
                    a(ng-hide="!isMyProfilePage()" href='/myProfile.html')
                      i.fa.fa-pencil
                      span edit profile
                    //- a
                  //- sup
                //- name
              //- photo
            //- col-md-3
          //- row
          .row
            .col-sm-9.col-md-9.col-sm-offset-3.col-md-offset-3
              .userprofilemenu
                nav.menu
                  .btn-add-friend(ng-hide="isMyFriend()")
                    a.btn.btn-success.btn-sm(href="#")
                      i.fa.fa-user-plus
                      | Add friend
                    //- a
                    | &nbsp;
                    a.btn.btn-success.btn-sm(href="#")
                      | Follow
                    //- a
                  //- btn-add-friend
                  ul
                    li
                      a.active(href="#") Timeline
                    //- li
                    li
                      a(href='#modal_coming_soon', data-toggle='modal').hide.NOTYET About
                    //- li
                    li
                      a(href='#modal_coming_soon', data-toggle='modal').hide.NOTYET Circlebuys
                    //- li
                    li
                      a(href='#modal_coming_soon', data-toggle='modal').hide.NOTYET Circles
                    //- li
                    li
                      a(href='#modal_coming_soon', data-toggle='modal').hide.NOTYET Reviews
                    //- li
                    li
                      a(href='#modal_coming_soon', data-toggle='modal').hide.NOTYET Activity
                    //- li
                  //- ul
                //- nav
              //- userprofilemenu
            //- col-md-6
          //- row
        //- container
      //- info
    //- banner-home

    section.userprofile
      .container
        .row
          .col-md-3.hidden-xs.hidden-sm
            //- .search.circle
            //-   a(href="#", target="_blank")
            //-     i.fa.fa-search
            //-   //- a
            //-   input.form-control(type='text', placeholder='search the circle...')
            //- //- search
            
            
            // Interests section
            .intro.hidden-xs.hidden-sm
              a.btn.btn-success.btn-sm.btn-add-interests(ng-hide="!isMyProfilePage()" href="/myProfile.html", data-toggle="modal")
                i.fa.fa-plus
                | Add Interests
              //- a
              h4 Interests
              p
                span(ng-repeat="interest in profile.interests")
                  a(href='#modal_coming_soon', data-toggle='modal') {{interest.value}}
                  br
                //- br
                //- br
                //- a(href='#modal_coming_soon', data-toggle='modal') Beer
                //- br
                //- a(href='#modal_coming_soon', data-toggle='modal') White Wine
                //- br
                //- a(href='#modal_coming_soon', data-toggle='modal') Travel
                //- br
                //- a(href='#modal_coming_soon', data-toggle='modal') Sport
                //- br
                //- a(href='#modal_coming_soon', data-toggle='modal') Music
                //- br
                //- a(href='#modal_coming_soon', data-toggle='modal') Movies
                //- br
                //- a(href='#modal_coming_soon', data-toggle='modal') Reading
              //- p
              hr
              .info
                p
                  i.fa.fa-briefcase
                  span Works at&nbsp;
                  br
                  span(ng-repeat="work in profile.work")
                    span.text-muted {{work}}
                    br
                //- p
              hr
              .info
                p
                  i.fa.fa-graduation-cap
                  span Studied at&nbsp;
                  br
                  span(ng-repeat="study in profile.education")
                    span.text-muted {{study}}
                    br
                //- p
              hr
              .info
                p
                  i.fa.fa-home
                  span Lives in&nbsp;
                  span.text-muted Palm Beach, New South Wales, Australia
                //- p
                p
                  i.fa.fa-map-marker
                  span From&nbsp;
                  span.text-muted Sydney, Australia
                //- p
              //- info
            //- intro


            // My Circlebuys section
            .list_groups.groups.hidden-xs.hidden-sm
              .head
                h4
                  a(href='#modal_coming_soon', data-toggle='modal') My circlebuys
                  small (
                    a(href='#modal_coming_soon', data-toggle='modal') 5
                    | )
                //- h4
              //- head
              .content
                .productdetails
                  .infos
                    .text-center
                      .card_rounded
                        a(href='#modal_preview_detail_brokenwood', data-toggle='modal')
                          span Brokenwood
                            br
                            small.el Graveyard Vineyard Shiraz 2010
                          //- span
                        //- a
                        hr
                        span Adrian's circlebuy
                          br
                          | 10 cases -&nbsp;
                          strong SAVE $8&nbsp;
                          small /bottle
                        hr
                        .shortsummary
                          .sold
                            p.cases-sold sold
                            p.lead
                              span.green 7
                              br
                              //- small cases
                            //- p
                          //- sold
                          .left
                            p left
                            p.lead
                              span.green 3
                              br
                              //- small cases
                            //- p
                          //- left
                        //- shortsummary
                        p
                        .avatar
                          .img
                            .ring._70p
                            img(src='assets/images/circles/circles_8.png', alt='')
                          //- img
                          .countdown
                            //- span.time 32:12
                            br
                            p
                              i.fa.fa-clock-o
                              span &nbsp;04:56.12
                            //- p
                            //- span
                          //- countdown
                        //- avatar
                        br
                        p
                          a.button.inline.v8.joincirclebuy(href='productdetails2.html') view
                          | &nbsp;
                          a.button.inline.v7.joincirclebuy(href="circlebuy-start.html") join
                          | &nbsp;
                          a.button.inline.v8.joincirclebuy(href="") watch
                        //- p
                        p.cbpromo-price 6 pack - $119.94
                        hr.short
                        p.lead.cbprice
                          strong  $19.99
                          small &nbsp;/ bottle
                        //- p
                        //- big
                      //- card_rounded
                    //- text-center
                  //- infos
                //- productdetails
              //- content
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- list_groups


            // My watchlist section
            .list_groups.groups.hidden-xs.hidden-sm.hide.NOTYET
              .head
                h4
                  a(href='#modal_coming_soon', data-toggle='modal') My watchlist
                  small (
                    a(href='#modal_coming_soon', data-toggle='modal') 3
                    | )
                //- h4
              //- head
              .content
                .productdetails
                  .infos
                    .text-center
                      .card_rounded
                        a(href='#modal_preview_detail_sticks', data-toggle='modal')
                          span Sticks
                            br
                            small.el Pinot Noir 2015
                          //- span
                        //- a
                        hr
                        span Sharmaine's circlebuy
                          br
                          | 10 cases -&nbsp;
                          strong SAVE $8&nbsp;
                          small /bottle
                        hr
                        .shortsummary
                          .sold
                            p.cases-sold sold
                            p.lead
                              span.green 5
                              br
                              //- small cases
                            //- p
                          //- sold
                          .left
                            p left
                            p.lead
                              span.green 5
                              br
                              //- small cases
                            //- p
                          //- left
                        //- shortsummary
                        p
                        .avatar
                          .img
                            .ring._50p
                            img(src='assets/images/circles/circles_1.png', alt='')
                          //- img
                          .countdown
                            //- span.time 32:12
                            br
                            p
                              i.fa.fa-clock-o
                              span &nbsp;16:08.00
                            //- p
                            //- span
                          //- countdown
                        //- avatar
                        br
                        p
                          a.button.inline.v8.joincirclebuy(href='productdetails2.html') view
                          | &nbsp;
                          a.button.inline.v7.joincirclebuy(href="circlebuy-start.html") join
                          | &nbsp;
                          a.button.inline.v8.joincirclebuy(href="") watch
                        //- p
                        p.cbpromo-price 12 pack - $179.88
                        hr.short
                        p.lead.cbprice
                          strong  $14.99
                          small &nbsp;/ bottle
                        //- p
                        //- big
                      //- card_rounded
                    //- text-center
                  //- infos
                //- productdetails
              //- content
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- list_groups


            // Friends section
            .grid_groups.friends.hidden-xs.hidden-sm
              h4
                a(href='#modal_coming_soon', data-toggle='modal') Friends
                small (
                  a(href='#modal_coming_soon', data-toggle='modal') 120
                  | )
              //- h4
              .content
                .container-fluid
                  .row
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_1.png", alt="")
                      //- img
                      .name
                        span Michael B...
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_2.png", alt="")
                      //- img
                      .name
                        span Georgia B...
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_3.png", alt="")
                      //- img
                      .name
                        span Nick Byrne
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_4.png", alt="")
                      //- img
                      .name
                        span Greg Stee...
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_5.png", alt="")
                      //- img
                      .name
                        span Amity Dela...
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_6.png", alt="")
                      //- img
                      .name
                        span Monica Ho...
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_7.png", alt="")
                      //- img
                      .name
                        span Max Farrow
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_8.png", alt="")
                      //- img
                      .name
                        span Michael Kay
                      //- name
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      .img
                        img(src="assets/images/friends/friends_9.png", alt="")
                      //- img
                      .name
                        span Ian Nuttall
                      //- name
                    //- col-md-4
                  //- row
                //- container
              //- content
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- grid_groups
            
            
            // Circles section
            .list_groups.groups.hidden-xs.hidden-sm.hide.NOTYET
              .head
                h4
                  a(href='#modal_coming_soon', data-toggle='modal') Circles
                  small (
                    a(href='#modal_coming_soon', data-toggle='modal') 23
                    | )
                //- h4
              //- head
              .content
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/circles/circles_1.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong northern beaches shiraz lovers
                    br
                    | 897 members
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/circles/circles_2.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong sydney pinot drinkers
                    br
                    | 168 members
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/circles/circles_3.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong hunter valley red fans
                    br
                    | 753 members
                    //- p
                  //- span
                //- input-group
              //- content
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- list_groups
            

            // Latest Activity section
            .list_groups.feed.hide.NOTYET
              .head
                h4
                  a(href='#modal_coming_soon', data-toggle='modal') Latest activity
              //- head
              .content
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/activity/img_advisor_2.jpg', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong Rodan Luzuriaga
                    | likes a photo.
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/anonymous.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href="profile.html")
                      strong Andrew Steer
                    | commented on his own post.
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/activity/img_advisor_2.jpg', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong Rodan Luzuriaga
                    | shared a post.
                    //- p
                  //- span
                //- input-group
              //- content
            //- feed

            
          //- col-md-3


          //
          // Wall part of the page (down the middle)
          //
          .col-md-6.col-sm-8(id="wallSection")
            
            .composer(ng-hide="!isMyProfilePage()", id="postComposer", style="display:none;")
              .head
                a#composer-status-button(href="#composer-tab-status", role="tab", data-toggle="tab")
                  i.fa.fa-pencil
                  | Status
                a(href="#composer-tab-photo-video", role="tab", data-toggle="tab")
                  i.fa.fa-picture-o
                  | Photo/Video
                a(href="#composer-tab-events", role="tab", data-toggle="tab").hide.NOTYET
                  i.fa.fa-calendar-o
                  | Events
              //- head
              
              
              .content.tab-content


                // Status tab
                .tab-pane.active#composer-tab-status(role="tabpanel")
                  textarea.form-control(id="postMessage" rows='2' ng-model="message" placeholder="Enter your description here")
                //- composer-tab-status


                // Photo tab
                .tab-pane#composer-tab-photo-video(role="tabpanel")
                  //- .drop-photo
                  //-   i.fa.fa-picture-o
                  //-   br
                  //-   span Drag Photos/Videos Here (1)
                  //- //- drop-photo

                  //.button(ngf-select="upload($file)" ng-model="file" name="file" ngf-pattern="'image/*'" ngf-accept="'image/*'" ngf-max-size="20MB" ngf-min-height="100" Zngf-resize="{width: 100, height: 100}")
                  //div(ngf-drop="uploadFiles($files)" class="drop-box" ngf-drag-over-class="'dragover'" ngf-multiple="true" ngf-pattern="'image/*,application/pdf'") DRAG
                  //br

                  //.drop-photo(ngf-select="upload($file)" ngf-drop="uploadFiles($files)" class="drop-box" ngf-drag-over-class="'dragover'" ngf-multiple="false" ngf-pattern="'image/*,video/*'")
                  .drop-photo(ngf-select ngf-drop class="drop-box" ng-model="file" ngf-drag-over-class="'dragover'" ngf-multiple="false" ngf-pattern="'image/*,video/*'" ng-hide="!showDropArea()")

                    i.fa.fa-picture-o
                    br
                    span Select File
                    span(ng-show="dropAvailable") &nbsp;or Drop File
                  //- drop-photo

                  img(ngf-src="file || '/assets/images/cleardot.png'" class="img-responsive" style="max-height: 400px")
                  video(controls ngf-src="file")
                  #percentage
                    #progress(ng-hide="!showProgressBar()")
                      .small.green
                        br
                        | Loading {{filename}}
                        | &nbsp;&nbsp;&nbsp; size={{filesize}} bytes
                        | &nbsp;&nbsp;&nbsp; ({{getPercentage()}}% complete)
                        br
                        .progress(style="height: 10px;")
                          .progress-bar.progress-bar-striped.active(role="progressbar" aria-valuenow="{{getPercentage()}}" aria-valuemin="0" aria-valuemax="100" ng-style="{width : ( getPercentage() + '%' ) }")
                            .sr-only {{getPercentage()}}% Complete (warning)
                    #processing(ng-hide="!showProcessing()")
                      .small.green
                        br
                        i.fa.fa-refresh.fa-spin.fa-fw
                        //  .sr-only Loading...
                        | Processing image


                  //- | Image thumbnail:
                  //- img(ngf-thumbnail="file || '/thumb.jpg'" Zstyle="width:200px;")
                  //- br
                  //- br



                  br
                  textarea.form-control(rows='2' ng-model="message" placeholder="Enter your description here")


                  //- .drop-photo(ngf-select ngf-drop="uploadFiles($files)" ng-model="files" ngf-model-invalid="invalidFiles",
                  //-   ngf-model-options="modelOptionsObj",
                  //-   ngf-multiple="false" ngf-pattern="'image/*,video/*'" ngf-accept="acceptSelect",
                  //-   ng-disabled="disabled" ngf-capture="camera",
                  //-   ngf-drag-over-class="'dragover'",
                  //-   ngf-fix-orientation="orientation",
                  //-   ngf-max-files="1",
                  //-   ngf-ignore-invalid="1",
                  //-   ngf-allow-dir="false" Zclass="drop-box" ngf-drop-available="dropAvailable")
                  //-
                  //-   i.fa.fa-picture-o
                  //-   br
                  //-   span Select File
                  //-   span(ng-show="dropAvailable") &nbsp;or Drop File
                  //-   //span Drag Photos/Videos Here
                  //- //- drop-photo

                  //- #backend_upload
                  //-   h1 New Photo
                  //-   h2 Image file is uploaded through the server
                  //-   form(action="http://localhost:4000/junkphotos" enctype="multipart/form-data" method="post")
                  //-     .form_line
                  //-       label(for="photo_title") Title:
                  //-       .form_controls
                  //-         input#photo_title(name="title" size="30" type="text" value="<%=photo.title%>")
                  //-     .form_line
                  //-       label(for="photo_image") Image:
                  //-       .form_controls
                  //-         input#photo_image(name="image" type="file")
                  //-         input#photo_image_cache(name="image_cache" type="hidden")
                  //-     .form_line
                  //-       .form_controls
                  //-         input(name="commit" type="submit" value="Submit Photo")
                  //-     input#direct(name="direct" type="hidden")


                  //-   // See https://github.com/danialfarid/ng-file-upload
                  //-   // Upload on form submit or button click
                  //-   br
                  //-   br
                  //-   br
                  //-   | ----
                  //-   br
                  //-   form(Zng-app="fileUpload" Zng-controller="MyCtrl" name="form")
                  //-     // Single Image with validations
                  //-     .button(ngf-select ng-model="file" name="file" ngf-pattern="'image/*'" ngf-accept="'image/*'" ngf-max-size="20MB" ngf-min-height="100" Zngf-resize="{width: 100, height: 100}")
                  //-       | Select Single
                  //-     br
                  //-     br
                  //-
                  //-     // Multiple files
                  //-     .button(ngf-select ng-model="files" ngf-multiple="true")
                  //-       | Select Multiple
                  //-     br
                  //-     br
                  //-
                  //-     | Drop files:
                  //-     div(ngf-drop ng-model="files" class="drop-box")
                  //-       | Drop
                  //-       br
                  //-       br
                  //-     br
                  //-     br
                  //-     button(type="submit" ng-click="submit()")
                  //-       | submit
                  //-   //- form
                  //-
                  //-   // Upload right away after file selection:
                  //-   .button(ngf-select="upload($file)")
                  //-     | Upload on file select single
                  //-   br
                  //-   br
                  //-
                  //-   .button(ngf-select="uploadFiles($files)" multiple="multiple")
                  //-     | Upload on file select multiple
                  //-   br
                  //-   br
                  //-
                  //-   | Drop File:
                  //-   div(ngf-drop="uploadFiles($files)" class="drop-box" ngf-drag-over-class="'dragover'" ngf-multiple="true" ngf-pattern="'image/*,application/pdf'")
                  //-     | Drop Images or PDFs files here
                  //-     br
                  //-   br
                  //-   br
                  //-   div(ngf-no-file-drop)
                  //-     | File Drag/Drop is not supported for this browser
                  //-
                  //-   | Image thumbnail:
                  //-   img(ngf-thumbnail="file || '/thumb.jpg'" Zstyle="width:200px;")
                  //-   br
                  //-   br
                  //-
                  //-   | Audio preview:
                  //-   audio(controls ngf-src="file")
                  //-   br
                  //-   br
                  //-
                  //-   | Video preview:
                  //-   video(controls ngf-src="file")
                  //-   br
                  //-   br
                  //- //- form

                //- composer-tab-photo-video


                // Events tab
                .tab-pane#composer-tab-events(role="tabpanel")
                  .drop-photo
                    i.fa.fa-picture-o
                    br
                    span Drag Event Photo Here
                  //- event-photo
                  .row
                    .col-md-12
                      .form-group
                        label(for='composer-event-name') Event Name
                        input#composer-event-name.form-control(type='text', placeholder='')
                      //- form-group
                    //- col-md-12
                    .col-md-12
                      .form-group
                        label(for='composer-location') Location
                        input#composer-location.form-control(type='text', placeholder='')
                      //- form-group
                    //- col-md-12
                    .col-md-6.col-sm-6.col-xs-6
                      .form-group
                        label(for='composer-event-date-from') From
                        input#composer-event-date-from.form-control(type='date', placeholder='')
                      //- form-group
                    //- col-md-6
                    .col-md-6.col-sm-6.col-xs-6
                      .form-group
                        label(for='composer-event-date-to') to
                        input#composer-event-date-to.form-control(type='date', placeholder='')
                      //- form-group
                    //- col-md-6
                    .col-md-12
                      .form-group
                        label(for='composer-description') Description
                        textarea#composer-description.form-control(rows="3")
                      //- form-group
                    //- col-md-12
                  //- row
                //- composer-tab-events

              //- content
              .controls
                // The next line sets the height of the footer,
                // when all else is hidden
                a &nbsp;

                a(href='#modal_coming_soon', data-toggle='modal').hide
                  i.fa.fa-camera
                //- a
                a(href='#modal_coming_soon', data-toggle='modal').hide
                  i.fa.fa-user-plus
                //- a
                a(href='#modal_coming_soon', data-toggle='modal').hide
                  i.fa.fa-smile-o
                //- a
                a(href='#modal_coming_soon', data-toggle='modal').hide
                  i.fa.fa-map-marker
                //- a
                a(href='#modal_coming_soon', data-toggle='modal').hide
                  i.fa.fa-clock-o
                //- a

                a.post(ng-click="cancelPost()" ng-hide="!haveMessage()")
                  i.fa.fa-remove
                  | Cancel
                a.post(ng-click="uploadPost(message, file)" ng-hide="!haveMessage()")
                  i.fa.fa-send-o
                  | Post
                //- a
              //- controls
            //- composer

            div#timelineSection

          //- col-md-6
          
          
          
          //
          //  Right hand column
          //
          .col-md-3.col-sm-4


            // Top 10 section
            .list_groups.toppicks
              .head
                h4
                  a.pull-right(href='#modal_edit_toppicks', data-toggle='modal').hide.NOTYET
                    i.fa.fa-pencil
                  //- a
                  a(href='#modal_coming_soon', data-toggle='modal') My TOP 10
                //- h4
              //- head
              hr.hide.NOTYET
              .content
                .media
                  .media-left
                    h4 1.&nbsp;
                    img.media-object(src='assets/images/products/p14.jpg', alt='')
                  //- media-left
                  .media-body
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong Young Henrys
                    //- a
                    br
                    small Natural Lager

                    .points
                      span 96
                      small points
                    //- points
                  //- media-body
                //- media
                .media
                  .media-left
                    h4 2.&nbsp;
                    img.media-object(src='assets/images/products/p10.jpg', alt='')
                  //- media-left
                  .media-body
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong Somerby
                    //- a
                    br
                    small Apple Cider

                    .points
                      span 93
                      small points
                    //- points
                  //- media-body
                //- media
                .media
                  .media-left
                    h4 3.&nbsp;
                    img.media-object(src='assets/images/products/p2.jpg', alt='')
                  //- media-left
                  .media-body
                    a(href='productdetails2.html')
                      strong Brokenwood
                    //- a
                    br
                    small Graveyard Vineyard Shiraz

                    .points
                      span 94
                      small points
                    //- points
                  //- media-body
                //- media
              //- content
              //- .search
              //-   input.form-control(type='text', placeholder='search reviews...')
              //- //- search
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- feed


            // Reviews section
            .list_groups.reviews
              .head
                h4
                  a(href='#modal_coming_soon', data-toggle='modal') Reviews
                  small (
                    a(href='#modal_coming_soon', data-toggle='modal') 55
                    | )
                //- h4
              //- head
              .content
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/products/bottle8.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong Corona Extra
                    //- a
                    br
                    | Imported Beer
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/products/bottle1.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='productdetails2.html')
                      strong Brokenwood
                    //- a
                    br
                    | Graveyard Vineyard Shiraz
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/products/bottle7.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong Chivas Regal
                    //- a
                    br
                    | 12 Year Old Scotch Whisky 700ml
                    //- p
                  //- span
                //- input-group
              //- content
              .search.hide.NOTYET
                input.form-control(type='text', placeholder='search reviews...')
              //- search
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- feed
            
            
            // Photos section
            .grid_groups.friends
              h4
                a(href='#modal_coming_soon', data-toggle='modal') Photos
                small (
                  a(href='#modal_coming_soon', data-toggle='modal') 213
                  | )
              //- h4
              .content
                .container-fluid
                  .row
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_1.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_2.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_3.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_4.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_5.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_6.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_7.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_8.png", alt="")
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      img(src="assets/images/photos/photos_9.png", alt="")
                    //- col-md-4
                  //- row
                //- container
              //- content
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- grid_groups
            
            
            // Likes section
            .grid_groups.likes
              h4
                a(href='#modal_coming_soon', data-toggle='modal') Likes
                small (
                  a(href='#modal_coming_soon', data-toggle='modal') 16
                  | )
              //- h4
              .content
                .container-fluid
                  .row
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href="seller.html")
                        img(src="assets/images/likes/likes_1.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_2.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_3.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_4.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_5.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_6.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_7.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_8.png", alt="")
                      //- a
                    //- col-md-4
                    .col-xs-4.col-sm-4.col-md-4.thumb
                      a(href='#modal_coming_soon', data-toggle='modal')
                        img(src="assets/images/likes/likes_9.png", alt="")
                      //- a
                    //- col-md-4
                  //- row
                //- container
              //- content
              .more
                a(href='#modal_coming_soon', data-toggle='modal') See all
              //- more
            //- grid_groups


            // Chat section
            .list_search_groups.messaging.hide.NOTYET
              .head
                h4 Live chat
              //- head
              .content
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/users/user_3.jpg', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a.online(href="#") Darren Crone
                    small online
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/users/user_2.jpg', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a.offline(href="#") Rodan Luzuriaga
                    small 2hours ago
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/users/user_1.jpg', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a.online(href="profile.html") Andrew Steer
                    small online
                    //- p
                  //- span
                //- input-group
              //- content
              .search
                input.form-control(type='text')
                a.new(href="#")
                  i.fa.fa-pencil-square-o
                //- a
              //- search
            //- messaging
            
            // Events section
            .list_groups.events.hide.NOTYET
              .head
                h4
                  a(href='#modal_coming_soon', data-toggle='modal') Events
              //- head
              .content
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/likes/likes_1.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong brokenwood wine tasting
                    br
                    | 401-407 mcdonalds rd pokolbin nsw
                    br
                    small Saturday October 10th 2pm
                    //- p
                  //- span
                //- input-group
                .input-group
                  span.input-group-addon
                    .thumb
                      .img
                        img(src='assets/images/likes/likes_2.png', alt='')
                      //- img
                    //- thumb
                  span.form-control
                    a(href='#modal_coming_soon', data-toggle='modal')
                      strong margan wines wedding
                    br
                    | 1238 milbrodale rd broke nsw
                    br
                    small Saturday October 24th 4pm
                    //- p
                  //- span
                //- input-group
              //- content
            //- list_groups
          //- col-md-3
        //- row
      //- container
    //- section


block scripts
  // External Script goes here...
  script(src='assets/vendor/crowdhound/chUtil.js', type="text/javascript")
  script(src='assets/vendor/crowdhound/chtimeline.js', type="text/javascript")

  // See https://github.com/danialfarid/ng-file-upload
  //script(src='bower_components/ng-file-upload/ng-file-upload-shim.min.js', type="text/javascript")
  script(src='bower_components/ng-file-upload/ng-file-upload.min.js', type="text/javascript")
  script(src='bower_components/cloudinary/js/jquery.cloudinary.js', type="text/javascript")
  script.


    /*
     *  See if this page is showing the profile of a specific user.
     *  This code gets the "user" parameter from the url.
     */
    var userId = NaN;
    window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) {
      if (key === 'user') {
        userId = parseInt(value);
      }
    });
    console.log('Displaying the page for userId=' + userId);


    /************************************************************
     *
     *    Angular code.
     */
    var app = angular.module('myApp', ['ngSanitize', 'ngFileUpload', 'pastac-login']);

    teaservice.init({
      host: TEASERVICE_HOST,
      port: TEASERVICE_PORT,
      accessToken: TEASERVICE_ACCESS_TOKEN
    });

    // Add the controller for this page
    app.controller('pageCtrl', function($scope, $timeout, teaService, Upload) {






      /*
       *  File uploading stuff.
       *  See https://github.com/danialfarid/ng-file-upload
       */
      $scope.uploadPost = function(message, file) {
        console.log('upload()');

        var url = 'http://localhost:4000/api/2.0/drinkpoint/element?authenticationToken=U0X11WJTRM1DWIC74N1MJBQP';

        //var message = $scope.message;
        var data = {
          "type" : "post",
          "rootId" : "$community-page-user-"+userId,
          "parentId" : "$community-page-user-"+userId,
          "description" : message,
          //"anchor" : 'community-page-post-'+userId,
          "deleted" : 0
        };

        console.log('url is ' + url);
        console.log('data is ', data);
        console.log('file is ', file);


        // See if we have a photo or video to load.
        var activeTabId = $(".composer .tab-pane.active").attr('id');
        if (file && activeTabId === 'composer-tab-photo-video') {

          // Have an image being loaded
          $scope.filesize = accounting.formatNumber(file.size);
          $scope.filename = file.name;
          data.file = file;
          Upload.upload({
              //url: 'http://localhost:4000/junkphotos',
              url: url,
              data: data
          }).then(function (resp) {
            console.log('resp: ', resp);
              console.log('Success ' + resp.config.data.file.name + 'uploaded. Response: ' + resp.data);

              // Reload the posts
              TimelinePost.manualRenderPost(resp.data.elementId, '#timelineSection');
              $timeout(function(){
                $scope.message = '';
                $scope.file = null;
                $scope.progressPercentage = null; // hide the progress bar again
                $('#composer-status-button').tab('show');
              }, 1);

          }, function (resp) {
              console.log('Error status: ' + resp.status);
          }, function (evt) {
            console.log('evt=', evt);
            // Show the image loading progress
            var perc = parseInt(100.0 * evt.loaded / evt.total);
            console.log('progress: ' + perc + '% ' + evt.config.data.file.name);
            $timeout(function(){
              $scope.progressPercentage = perc;
            }, 1);
          });
        } else {

          // No image being loaded
          $.ajax({
              type : "POST",
              url : url,
              data : data,
              success : function(messageResponse) {
                  if (messageResponse
                      && messageResponse.status
                      && messageResponse.status === "ok") {

                      //check message for any url links
                      //var urls = findUrls(message);
                      //if(urls.length == 1){
                          //found a url now we save an element
                      //    TimelinePost.savePostElement(messageResponse.elementId, urls[0]);
                      //}else{
                          //just post the message
                          TimelinePost.manualRenderPost(messageResponse.elementId, '#timelineSection');
                      //}

                      //clear textarea
                      $timeout(function(){
                        $scope.message = '';
                        $scope.file = null;
                        $scope.progressPercentage = null; // hide the progress bar again
                        $('#composer-status-button').tab('show');
                      }, 1);

                  } else {
                      //Alerts.showStandardError(".textarea");
                  }
              },

              error : function(qXHR, textStatus, errorThrown) {
                  console.log('An error occurred while posting.\n  status: ' + qXHR.status + "\n  responseText: ", qXHR.responseText);
                  //Alerts.showStandardError(".textarea");
              }
          });

        }

      };
      
      $scope.cancelPost = function() {
        $scope.file = null;
        $scope.progressPercentage = null;
        $('#composer-status-button').tab('show');
      }
      
      $scope.haveMessage = function() {
        console.log('message is ', $scope.message);
        console.log('file is ', $scope.file);
        return (
          $scope.file
          || ($scope.message && $scope.message != '')
        );
      }

      $scope.showDropArea = function() {
        if ($scope.file) {
          return false;
        }
        return true;
      }

      $scope.showImage = function() {
        if ($scope.file) {
          return true;
        }
        return false;
      }

      $scope.showProgressBar = function() {
        return (
          $scope.file
          && $scope.progressPercentage
          && $scope.progressPercentage < 100
        );
      }

      $scope.showProcessing = function() {
        return (
          $scope.file
          && $scope.progressPercentage
          && $scope.progressPercentage == 100
        );
      }

      $scope.getPercentage = function() {
        return $scope.progressPercentage;
      }


      /*
       *  Set up the login part at the top of the page.
       */
      authservice.init({
        // Environment specific values are defined in environment.js
        host: AUTHSERVICE_HOST,
        port: AUTHSERVICE_PORT,
        tenant: AUTHSERVICE_TENANT,
        pretend: AUTHSERVICE_USE_DUMMY_LOGIN,
        onUserChange: function(loggedInUser, ttuat, fromCookie) {

          //alert('onUserChange');
          console.log('*** current user:', loggedInUser);
          console.log('*** required user: ' + userId);

          if (isNaN(userId)) {
            if (loggedInUser) {
              // If no userId was specified by the URL, show the current user.
              userId = loggedInUser.id;
            } else {

              // Should not have got here. Redirect to another page.
              alert('Need to redirect.');
            }
          }

          // Load the requested user
          var params = {
            entityId: userId,
            //nameMatch: q,
            needRelationships: true,
            needProperties: true,
            entityType: 'user',
            limit: 10 // Maximum of users
          };
          authservice.getUser(params, function(users) {

            // Return the
            if (users == null || users.length == 0) {
              console.log('no users')
              //ZZZZ redirect somewhere
              /*$timeout(function(){
                $scope.friendCandidate = null
              }, 50);*/
              return [ ];
            }

            // We have a user to display
            console.log('----->', users[0])
            $timeout(function(){
              setUserDetails(users[0]);

            }, 50);
          });
        }
      });
      return; //ZZZZ


      $(document).ready(function(){
          //TimelinePost.init();
      });





      function setUserDetails(user) {
        console.log('setUserDetails(): ', user);

        if ( !user.avatar) {
          user.avatar = 'assets/images/anonymous.png';
        }

        // Is this my profile page?
        $scope.isMyProfilePage = function() {
          var currentUser = authservice.getCurrentUser();
          //console.log('Current user:', authservice.getCurrentUser(), user);
          return (currentUser && currentUser.id == user.id);
        };

        // Get the properties for the user
        $scope.profile = { };
        if (user.propertySummary['drinkcircle.user.profile']) {
          var props = user.propertySummary['drinkcircle.user.profile'];
          $scope.userProfileProperties = props;
          //console.log('Have user profile properties', props)

          /*// Get the properties we use
          var dobArray = props['dob']
          if (dobArray && dobArray.length > 0) {
            $scope.profile.dob = dobArray[0].value;
          }*/
          var interestArray = props['interest']
          if (interestArray) {
            $scope.profile.interests = interestArray;
          }
        }


              var PROPERTY_REALM_PROFILE = 'user.profile';
              var PROPERTY_REALM_EDUCATION = 'user.education';
              var PROPERTY_REALM_WORK = 'user.work';


        // Get the ids of the friends
        var userIdsForWall = '' + userId;
        if (user.relationshipSummary.hasFriend) {
          //console.log('onUserChange: user.relationshipSummary.hasFriend:', user.relationshipSummary.hasFriend)
          var arrayOfFriends = user.relationshipSummary.hasFriend
          //arrayOfFriends.sort(sortRelationshipSummaryByFullname)
          console.log('friends=', arrayOfFriends);
          $scope.friends = arrayOfFriends

          for (var i = 0; i < $scope.friends.length; i++) {
            userIdsForWall += ',' + $scope.friends[i].entity_id;
          }

        } else {
          $scope.friends = [ ]
        }
        console.log('ids for wall=' +  userIdsForWall);


        $scope.isMyFriend = function() {
          return $scope.isMyProfilePage();

          var currentUser = authservice.getCurrentUser();
          if (currentUser) {
            for (var i = 0; i < $scope.friends.length; i++) {
              if ($scope.friends[i].entity_id == currentUser.id) {
                alert('is a friend already')
                return true;
              }
            }
          }
          return false;
        };


        // Load the Time line
        setTimeout(function() {
          TimelinePost.init(userId, userIdsForWall);
        }, 2000);



        // Look at employment
        //$scope.profile.employment = [ ];
        $scope.profile.work = [ ];
        if (user.propertySummary[PROPERTY_REALM_WORK] && user.propertySummary[PROPERTY_REALM_WORK].data) {
          var employers = user.propertySummary[PROPERTY_REALM_WORK].data;
          for (var i = 0; i < employers.length; i++) {

            // Parse the JSON stored in the property.
            var workData = employers[i].value;
            try {
              var obj = JSON.parse(workData);
            } catch (e) {
              console.log('Invalid JSON for property ' + employers[i].property_id);
              continue;
            }
            $scope.profile.work.push(obj.company);
          }
          console.log('work=', $scope.profile.work);
        }


        // Look at education
        $scope.profile.education = [ ];
        if (user.propertySummary[PROPERTY_REALM_EDUCATION] && user.propertySummary[PROPERTY_REALM_EDUCATION].attended) {
          var attended = user.propertySummary[PROPERTY_REALM_EDUCATION].attended;
          for (var i = 0; i < attended .length; i++) {

            // Parse the JSON stored in the property.
            var schoolData = attended[i].value;
            try {
              var obj = JSON.parse(schoolData);
            } catch (e) {
              console.log('Invalid JSON for property ' + attended[i].property_id);
              continue;
            }
            $scope.profile.education.push(obj.name);
          }
          console.log('education=', $scope.profile.education);
        }



        $scope.user = user;
      }

    });// app.controller


  //templates
  script(id='timelineList', type='text/template')
    <<{childrenHtml}>>


  script(id='timelinePost', type='text/template')
    <<#element>>


      <div class="timeline" data-owner-id=<<user.userId>> data-post-id=<<id>>>
          <<#_cloudinaryImage_raw>>
            <img class="img-responsive" src="<<_cloudinaryImage_lowquality>>" srcset="<<_cloudinaryImage_320>> 320w, <<_cloudinaryImage_480>> 480w, <<_cloudinaryImage_768>> 768w, <<_cloudinaryImage_992>> 992w, <<_cloudinaryImage_1200>> 1200w, <<_cloudinaryImage_1920>> 1920w" sizes="(max-width: 30em) 30em, 100vw" style="width:100%;">
          <</_cloudinaryImage_raw>>

          <div class="content">
              <div class="head">
                  <div class="user">
                      <div class="img">
                          <img class="minAvatar" src="<<user.avatar>>" alt="">
                      </div>
                      <a href="/profile.html?user=<<user.userId>>"><<user.firstName>> <<user.lastName>></a>
                  </div>
                  <div class="more">
                      <ul class="nav navbar-nav navbar-right">
                          <li class="dropdown">
                              <ul class="dropdown-menu" style="top: 35px;">
                              //{{#scopes.isUserLoggedIn}}
                              //    <li><a id="deletePost" href="javascript:void(0);" onclick="TimelinePost.deletePost(<<id>>, <<parentId>>, <<rootId>>);">Delete</a></li>
                              //    <li><a id="editPost" href="javascript:void(0);">Edit</a></li>
                              //{{/scopes.isUserLoggedIn}}
                              //{{^scopes.isUserLoggedIn}}
                                <li><a id="hidePost" href="javascript:void(0);">Hide</a></li>
                              //{{/scopes.isUserLoggedIn}}
                              </ul>
                              <a aria-expanded="false" aria-haspopup="true" class="dropdown-toggle info postToggle" data-toggle="dropdown" href="#" role="button"><i class="fa fa-chevron-down"></i></a>

                          </li>
                      </ul>
                  </div>
              </div>
              <div class="inner">
                  <div class="caption">
                      <p>
                          <<{description}>>
                      </p>
                  </div>
                  <<{htmlLinkPost}>>
              </div>
              <div id="post-likes-<<id>>" style="display :<<#likes>>block<</likes>> <<^likes>>none<</likes>>;">
                <br/>
                <a href="#"><i class="fa fa-heart"></i>&nbsp;<span id="post-likes-counter-<<id>>"><<likes>></span></a>
              </div>
          </div>
          <div class="controls">
              <<^liked>>
                <a id="post-like-anchor-<<id>>" href="javascript:void(0);" onclick="TimelinePost.like(<<id>>, 1);"><i class="fa fa-heart"></i>Like</a>
              <</liked>>
              <<#liked>>
                <a id="post-like-anchor-<<id>>" href="javascript:void(0);" onclick="TimelinePost.like(<<id>>, 0);"><i class="fa fa-heart"></i>Unlike</a>
              <</liked>>
              <a href="javascript:void(0);" onclick="TimelinePost.toogleComment(<<id>>);"><i class="fa fa-comment"></i>Comment</a>
              <div class="fb-share-button" data-href="<<user.shareLink>>/<<id>>" data-layout="button_count">
              </div>
          </div>
          <div class="footer">
              <div id="comments-<<id>>" class="comments">
                  <<{childrenHtml}>>
              </div>
              <div id="comment-<<id>>" class="comment" style="display:none;">
                  <div class="input-group">
                      <span class="input-group-addon">
                          <div class="thumb">
                              <div class="img">
                                  <img src="<<user.avatar>>" alt="">
                              </div>
                          </div>
                      </span>
                      <input class="form-control" type="text" placeholder="Write a comment..."><span class="input-group-addon"><a href="javascript:void(0);" onclick="TimelinePost.commentOnAPost(<<id>>)"><i class="fa fa-send"></i></a></span>
                  </div>
              </div>
          </div>
      </div>
    <</element>>


  script(id='timelinePostComment', type='text/template')
    <<#element>>
      <div class="input-group">
          <span class="input-group-addon">
              <div class="thumb">
                    <div class="img">
                        <img src="<<user.avatar>>" alt="">
                    </div>
              </div>
              </span><span class="form-control"><strong><a href="<<user.communityPage>>"><<user.firstName>> <<user.lastName>></a></strong> <<description>>
              <p>
                  <a href="#">Like</a>&nbsp;&nbsp;<a href="#">Reply</a><small>&nbsp<<createdDateFromNow>></small>
              </p>
          </span>
      </div>
    <</element>>
